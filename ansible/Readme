Pre-requisites
1. The Ansible control node (where you'll run the Ansible commands) must be able to SSH to all the nodes without a password. This can be done by generating SSH keys and copying the public key to all the nodes.
2. The hosts.ini file needs to be updated with the IP addresses of all the nodes under the corresponding groups.
3. haproxy.cfg needs to be updated with the correct IP addresses and ports of the nodes before running mainplaybook.yml
4. The nodes must allow port 22 for SSH, port 6443 for Kubernetes API server and 2379-2380 for etcd. These ports need to be opened on any firewall.

Once you have these things in place, you can run the various Ansible playbooks to configure your setup!


Run all playbook at once
ansible-playbook -i hosts.ini mainplaybook.yml

haproxy.cfg
This configures HAProxy as a load balancer.
Make sure to update the ip and port settings in haproxy.cfg before running.
mainplaybook.yml

Run seperate playbooks individually:

install_kubernetes
This installs all Kubernetes components on the master and worker nodes.
To run:
ansible-playbook -i hosts.ini --limit 'master:worker' install_kubernetes.yml
This will exclude the load balancer group.

init_kubernetes.yml
This initializes the Kubernetes cluster.
To run:
ansible-playbook -i hosts.ini --limit 'master[0]' init_kubernetes.yml
This will use the first master node in hosts.ini as the primary master and initialize the cluster.

install_haproxy.yml
This installs HAProxy on the load balancer nodes.
To run:
ansible-playbook -i hosts.ini --limit 'loadbalancer' install_haproxy.yml

set_hostname.yml
This sets the hostname of nodes.
To run:
ansible-playbook set_hostname.yml -i inventory.ini